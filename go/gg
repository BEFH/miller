#!/bin/bash

path_to_mlr="./mlr"
indir="./reg-test/input"

build-go
if [ $? -ne 0 ]; then
  exit 1
fi

# ----------------------------------------------------------------
run_mlr() {
  echo
  echo $path_to_mlr "$@"
  echo
  $path_to_mlr "$@"
}

# ----------------------------------------------------------------
mlr_expect_fail() {
  echo
  echo $path_to_mlr "$@"
  echo
  $path_to_mlr "$@"
  status=$?
  if [ $status -eq 0 ]; then
    echo "failed to fail"
  fi
}

# ----------------------------------------------------------------
run_cat() {
  echo
  echo cat "$@"
  echo
  cat "$@"
}

# ----------------------------------------------------------------
announce() {
  echo
  echo "================================================================"
  echo
  echo "$@"
}

# ----------------------------------------------------------------
mention() {
  echo
  echo ---------------------------------------------------------------- "$@"
}

# ================================================================

run_mlr --from r put -q '
  a = 1;
  b = 2;
  print;
  print "OUT1a ". a;
  print "OUT1b ". b;
  if (NR == 1) {
    a = 3;
    c = 4;
    print "IN1a  ". a;
    print "IN1c  ". c;
  } else {
    b = 5;
    d = 6;
    print "IN2a  ". b;
    print "IN2c  ". d;
  }
  print "OUT2a ". a;
  print "OUT2a ". b;
'

# OUT1a 1
# OUT1b 2
# IN1a  3
# IN1c  4
# OUT2a 3
# OUT2a 2
#
# OUT1a 1
# OUT1b 2
# IN2a  5
# IN2c  6
# OUT2a 1
# OUT2a 5

# ================================================================
