

================================================================
USER-DEFINED FUNCTIONS

mlr --opprint --from ././reg-test/input/abixy put func f(u,v){return u+v} $o=f(NR*1000,$x)
a   b   i  x                   y                   o
pan pan 1  0.3467901443380824  0.7268028627434533  1000.346790
eks pan 2  0.7586799647899636  0.5221511083334797  2000.758680
wye wye 3  0.20460330576630303 0.33831852551664776 3000.204603
eks wye 4  0.38139939387114097 0.13418874328430463 4000.381399
wye pan 5  0.5732889198020006  0.8636244699032729  5000.573289
zee pan 6  0.5271261600918548  0.49322128674835697 6000.527126
eks zee 7  0.6117840605678454  0.1878849191181694  7000.611784
zee wye 8  0.5985540091064224  0.976181385699006   8000.598554
hat wye 9  0.03144187646093577 0.7495507603507059  9000.031442
pan wye 10 0.5026260055412137  0.9526183602969864  10000.502626

mlr --opprint --from ././reg-test/input/abixy put func f(x,y,z){$nnn=999; int n=10; return $y} $o=f($i,$x,$y)
mlr: assignments to $-variables are not valid within func blocks.

mlr -n put -q -f ././reg-test/input/sieve.mlr
2
3
5
7
11
13
17
19
23
29
31
37
41
43
47
53
59
61
67
71
73
79
83
89
97

mlr -n put -q -f ././reg-test/input/mand.mlr -e begin {@verbose = true}
RCORN     = -2.000000
ICORN     = -2.000000
SIDE      = 4.000000
IHEIGHT   = 50
IWIDTH    = 100
MAXITS    = 100
LEVELSTEP = 5
CHARS     = @X*o-.
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXX.XXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXooXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXX**o..*XXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXX*-....-oXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXX@XXXXXXXXXX*......o*XXXXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXXX**oo*-.-........oo.XXXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXXXXXX....................X..o-XXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@XXXXXXXXXXXXXXX*oo......................oXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@XXX*XXXXXXXXXXXX**o........................*X*X@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@XXXXXXooo***o*.*XX**X..........................o-XX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@XXXXXXXX*-.......-***.............................oXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@XXXXXXXX*@..........Xo............................*XX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@XXXX@XXXXXXXX*o@oX...........@...........................oXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.........................................................o*XXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@XXXXXXXXX*-.oX...........@...........................oXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@XXXXXXXXXX**@..........*o............................*XXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@XXXXXXXXXXXXX-........***.............................oXXXXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@XXXXXXXXXXXXoo****o*.XX***@..........................o-XXXXXXXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@XXXXX*XXXX*XXXXXXX**-........................***XXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@XXXXXXXXXXXXX*o*.....................@o*XXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXXXXX*....................*..o-XX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXX*ooo*-.o........oo.X*XXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXX**@.....*XXXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXX*o....-o*XXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXXXo*o..*XXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXXXXXX*o*XXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXXXXX@XXXXXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXXXXXX@@XXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@XXXXX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

mlr --from ././reg-test/input/abixy put func f(x,y) { return 2*y } $o = f($x,$y) 
a=pan,b=pan,i=1,x=0.3467901443380824,y=0.7268028627434533,o=1.453606
a=eks,b=pan,i=2,x=0.7586799647899636,y=0.5221511083334797,o=1.044302
a=wye,b=wye,i=3,x=0.20460330576630303,y=0.33831852551664776,o=0.676637
a=eks,b=wye,i=4,x=0.38139939387114097,y=0.13418874328430463,o=0.268377
a=wye,b=pan,i=5,x=0.5732889198020006,y=0.8636244699032729,o=1.727249
a=zee,b=pan,i=6,x=0.5271261600918548,y=0.49322128674835697,o=0.986443
a=eks,b=zee,i=7,x=0.6117840605678454,y=0.1878849191181694,o=0.375770
a=zee,b=wye,i=8,x=0.5985540091064224,y=0.976181385699006,o=1.952363
a=hat,b=wye,i=9,x=0.03144187646093577,y=0.7495507603507059,o=1.499102
a=pan,b=wye,i=10,x=0.5026260055412137,y=0.9526183602969864,o=1.905237

mlr --opprint --from ././reg-test/input/abixy put $o1 = a; int a=1000+NR; $o2 = a; a=2000+NR; $o3 = a
a   b   i  x                   y                   o2   o3
pan pan 1  0.3467901443380824  0.7268028627434533  1001 2001
eks pan 2  0.7586799647899636  0.5221511083334797  1002 2002
wye wye 3  0.20460330576630303 0.33831852551664776 1003 2003
eks wye 4  0.38139939387114097 0.13418874328430463 1004 2004
wye pan 5  0.5732889198020006  0.8636244699032729  1005 2005
zee pan 6  0.5271261600918548  0.49322128674835697 1006 2006
eks zee 7  0.6117840605678454  0.1878849191181694  1007 2007
zee wye 8  0.5985540091064224  0.976181385699006   1008 2008
hat wye 9  0.03144187646093577 0.7495507603507059  1009 2009
pan wye 10 0.5026260055412137  0.9526183602969864  1010 2010

mlr --opprint --from ././reg-test/input/abixy put 
    func f(n) {
        if (is_numeric(n)) {
            if (n > 0) {
                return n * f(n-1)
            } else {
                return 1
            }
        }
        # implicitly return absent
    }
    $o = f(NR)

a   b   i  x                   y                   o
pan pan 1  0.3467901443380824  0.7268028627434533  1
eks pan 2  0.7586799647899636  0.5221511083334797  2
wye wye 3  0.20460330576630303 0.33831852551664776 6
eks wye 4  0.38139939387114097 0.13418874328430463 24
wye pan 5  0.5732889198020006  0.8636244699032729  120
zee pan 6  0.5271261600918548  0.49322128674835697 720
eks zee 7  0.6117840605678454  0.1878849191181694  5040
zee wye 8  0.5985540091064224  0.976181385699006   40320
hat wye 9  0.03144187646093577 0.7495507603507059  362880
pan wye 10 0.5026260055412137  0.9526183602969864  3628800

mlr --from ././reg-test/input/abixy --opprint put 
  func f(n) {
    return n+1;
  }
  $o1 = f(NR);
  $o2 = f(f(NR));
  $o3 = f(f(f(NR)));
  $o4 = f(f(f(f(NR))));
  $o5 = f(f(f(f(f(NR)))));
  $o6 = f(f(f(f(f(f(NR))))));

a   b   i  x                   y                   o1 o2 o3 o4 o5 o6
pan pan 1  0.3467901443380824  0.7268028627434533  2  3  4  5  6  7
eks pan 2  0.7586799647899636  0.5221511083334797  3  4  5  6  7  8
wye wye 3  0.20460330576630303 0.33831852551664776 4  5  6  7  8  9
eks wye 4  0.38139939387114097 0.13418874328430463 5  6  7  8  9  10
wye pan 5  0.5732889198020006  0.8636244699032729  6  7  8  9  10 11
zee pan 6  0.5271261600918548  0.49322128674835697 7  8  9  10 11 12
eks zee 7  0.6117840605678454  0.1878849191181694  8  9  10 11 12 13
zee wye 8  0.5985540091064224  0.976181385699006   9  10 11 12 13 14
hat wye 9  0.03144187646093577 0.7495507603507059  10 11 12 13 14 15
pan wye 10 0.5026260055412137  0.9526183602969864  11 12 13 14 15 16

mlr --from ././reg-test/input/abixy --opprint put 
  func f(n) {
      if (n < 2) {
          return 1
      } else {
          return f(n-1) + f(n-2)
      }
  }
  $o = f(NR)

a   b   i  x                   y                   o
pan pan 1  0.3467901443380824  0.7268028627434533  1
eks pan 2  0.7586799647899636  0.5221511083334797  2
wye wye 3  0.20460330576630303 0.33831852551664776 3
eks wye 4  0.38139939387114097 0.13418874328430463 5
wye pan 5  0.5732889198020006  0.8636244699032729  8
zee pan 6  0.5271261600918548  0.49322128674835697 13
eks zee 7  0.6117840605678454  0.1878849191181694  21
zee wye 8  0.5985540091064224  0.976181385699006   34
hat wye 9  0.03144187646093577 0.7495507603507059  55
pan wye 10 0.5026260055412137  0.9526183602969864  89

mlr --from ././reg-test/input/abixy --opprint put 
  func f(n) {
    if (is_present(@fcache[n])) {
      return @fcache[n]
    } else {
      num rv = 1;
      if (n >= 2) {
        rv = f(n-1) + f(n-2)
      }
      @fcache[n] = rv;
      return rv
    }
  }
  $o = f(NR)

a   b   i  x                   y                   o
pan pan 1  0.3467901443380824  0.7268028627434533  1
eks pan 2  0.7586799647899636  0.5221511083334797  2
wye wye 3  0.20460330576630303 0.33831852551664776 3
eks wye 4  0.38139939387114097 0.13418874328430463 5
wye pan 5  0.5732889198020006  0.8636244699032729  8
zee pan 6  0.5271261600918548  0.49322128674835697 13
eks zee 7  0.6117840605678454  0.1878849191181694  21
zee wye 8  0.5985540091064224  0.976181385699006   34
hat wye 9  0.03144187646093577 0.7495507603507059  55
pan wye 10 0.5026260055412137  0.9526183602969864  89

