
mlr --opprint step -a rsum,shift,delta,counter -f x,y ./reg-test/input/abixy
a   b   i  x                   y                   x_rsum             x_shift             x_delta               x_counter y_rsum             y_shift             y_delta              y_counter
pan pan 1  0.3467901443380824  0.7268028627434533  0.3467901443380824 -                   0                     1         0.7268028627434533 -                   0                    1
eks pan 2  0.7586799647899636  0.5221511083334797  1.105470109128046  0.3467901443380824  0.41188982045188116   2         1.2489539710769328 0.7268028627434533  -0.20465175440997363 2
wye wye 3  0.20460330576630303 0.33831852551664776 1.3100734148943491 0.7586799647899636  -0.5540766590236605   3         1.5872724965935805 0.5221511083334797  -0.1838325828168319  3
eks wye 4  0.38139939387114097 0.13418874328430463 1.6914728087654902 0.20460330576630303 0.17679608810483793   4         1.7214612398778852 0.33831852551664776 -0.20412978223234313 4
wye pan 5  0.5732889198020006  0.8636244699032729  2.264761728567491  0.38139939387114097 0.19188952593085962   5         2.585085709781158  0.13418874328430463 0.7294357266189683   5
zee pan 6  0.5271261600918548  0.49322128674835697 2.7918878886593457 0.5732889198020006  -0.04616275971014583  6         3.0783069965295153 0.8636244699032729  -0.37040318315491594 6
eks zee 7  0.6117840605678454  0.1878849191181694  3.403671949227191  0.5271261600918548  0.08465790047599064   7         3.266191915647685  0.49322128674835697 -0.30533636763018757 7
zee wye 8  0.5985540091064224  0.976181385699006   4.0022259583336135 0.6117840605678454  -0.013230051461422976 8         4.24237330134669   0.1878849191181694  0.7882964665808366   8
hat wye 9  0.03144187646093577 0.7495507603507059  4.033667834794549  0.5985540091064224  -0.5671121326454867   9         4.9919240616973966 0.976181385699006   -0.22663062534830014 9
pan wye 10 0.5026260055412137  0.9526183602969864  4.536293840335763  0.03144187646093577 0.47118412908027796   10        5.944542421994383  0.7495507603507059  0.20306759994628054  10

mlr --opprint step -a rsum,shift,delta,counter -f x,y -g a ./reg-test/input/abixy
a   b   i  x                   y                   x_rsum              x_shift             x_delta             x_counter y_rsum              y_shift             y_delta              y_counter
pan pan 1  0.3467901443380824  0.7268028627434533  0.3467901443380824  -                   0                   1         0.7268028627434533  -                   0                    1
eks pan 2  0.7586799647899636  0.5221511083334797  0.7586799647899636  -                   0                   1         0.5221511083334797  -                   0                    1
wye wye 3  0.20460330576630303 0.33831852551664776 0.20460330576630303 -                   0                   1         0.33831852551664776 -                   0                    1
eks wye 4  0.38139939387114097 0.13418874328430463 1.1400793586611044  0.7586799647899636  -0.3772805709188226 2         0.6563398516177843  0.5221511083334797  -0.38796236504917503 2
wye pan 5  0.5732889198020006  0.8636244699032729  0.7778922255683036  0.20460330576630303 0.36868561403569755 2         1.2019429954199206  0.33831852551664776 0.5253059443866251   2
zee pan 6  0.5271261600918548  0.49322128674835697 0.5271261600918548  -                   0                   1         0.49322128674835697 -                   0                    1
eks zee 7  0.6117840605678454  0.1878849191181694  1.75186341922895    0.38139939387114097 0.23038466669670443 3         0.8442247707359537  0.13418874328430463 0.05369617583386477  3
zee wye 8  0.5985540091064224  0.976181385699006   1.1256801691982772  0.5271261600918548  0.07142784901456767 2         1.469402672447363   0.49322128674835697 0.48296009895064906  2
hat wye 9  0.03144187646093577 0.7495507603507059  0.03144187646093577 -                   0                   1         0.7495507603507059  -                   0                    1
pan wye 10 0.5026260055412137  0.9526183602969864  0.8494161498792961  0.3467901443380824  0.1558358612031313  2         1.6794212230404397  0.7268028627434533  0.22581549755353314  2

mlr --opprint step -a ewma -d 0.1,0.9 -f x,y -g a ./reg-test/input/abixy
a   b   i  x                   y                   x_ewma_0.1          x_ewma_0.9          y_ewma_0.1          y_ewma_0.9
pan pan 1  0.3467901443380824  0.7268028627434533  0.3467901443380824  0.3467901443380824  0.7268028627434533  0.7268028627434533
eks pan 2  0.7586799647899636  0.5221511083334797  0.7586799647899636  0.7586799647899636  0.5221511083334797  0.5221511083334797
wye wye 3  0.20460330576630303 0.33831852551664776 0.20460330576630303 0.20460330576630303 0.33831852551664776 0.33831852551664776
eks wye 4  0.38139939387114097 0.13418874328430463 0.7209519076980814  0.41912745096302323 0.4833548718285622  0.17298497978922212
wye pan 5  0.5732889198020006  0.8636244699032729  0.2414718671698728  0.5364203583984308  0.3908491199553103  0.8110938754646104
zee pan 6  0.5271261600918548  0.49322128674835697 0.5271261600918548  0.5271261600918548  0.49322128674835697 0.49322128674835697
eks zee 7  0.6117840605678454  0.1878849191181694  0.7100351229850579  0.5925183996073632  0.4538078765575229  0.18639492518527467
zee wye 8  0.5985540091064224  0.976181385699006   0.5342689449933116  0.5914112242049656  0.5415172966434219  0.9278853758039411
hat wye 9  0.03144187646093577 0.7495507603507059  0.03144187646093577 0.03144187646093577 0.7495507603507059  0.7495507603507059
pan wye 10 0.5026260055412137  0.9526183602969864  0.3623737304583956  0.4870424194209006  0.7493844124988066  0.9300368105416331

mlr --opprint step -a ewma -d 0.1,0.9 -o smooth,rough -f x,y -g a ./reg-test/input/abixy
a   b   i  x                   y                   x_ewma_smooth       x_ewma_rough        y_ewma_smooth       y_ewma_rough
pan pan 1  0.3467901443380824  0.7268028627434533  0.3467901443380824  0.3467901443380824  0.7268028627434533  0.7268028627434533
eks pan 2  0.7586799647899636  0.5221511083334797  0.7586799647899636  0.7586799647899636  0.5221511083334797  0.5221511083334797
wye wye 3  0.20460330576630303 0.33831852551664776 0.20460330576630303 0.20460330576630303 0.33831852551664776 0.33831852551664776
eks wye 4  0.38139939387114097 0.13418874328430463 0.7209519076980814  0.41912745096302323 0.4833548718285622  0.17298497978922212
wye pan 5  0.5732889198020006  0.8636244699032729  0.2414718671698728  0.5364203583984308  0.3908491199553103  0.8110938754646104
zee pan 6  0.5271261600918548  0.49322128674835697 0.5271261600918548  0.5271261600918548  0.49322128674835697 0.49322128674835697
eks zee 7  0.6117840605678454  0.1878849191181694  0.7100351229850579  0.5925183996073632  0.4538078765575229  0.18639492518527467
zee wye 8  0.5985540091064224  0.976181385699006   0.5342689449933116  0.5914112242049656  0.5415172966434219  0.9278853758039411
hat wye 9  0.03144187646093577 0.7495507603507059  0.03144187646093577 0.03144187646093577 0.7495507603507059  0.7495507603507059
pan wye 10 0.5026260055412137  0.9526183602969864  0.3623737304583956  0.4870424194209006  0.7493844124988066  0.9300368105416331

mlr --odkvp step -a rsum,shift,delta,counter -f x,y ./reg-test/input/abixy-het
a=pan,b=pan,i=1,x=0.3467901443380824,y=0.7268028627434533,x_rsum=0.3467901443380824,x_shift=,x_delta=0,x_counter=1,y_rsum=0.7268028627434533,y_shift=,y_delta=0,y_counter=1
a=eks,b=pan,i=2,x=0.7586799647899636,y=0.5221511083334797,x_rsum=1.105470109128046,x_shift=0.3467901443380824,x_delta=0.41188982045188116,x_counter=2,y_rsum=1.2489539710769328,y_shift=0.7268028627434533,y_delta=-0.20465175440997363,y_counter=2
aaa=wye,b=wye,i=3,x=0.20460330576630303,y=0.33831852551664776,x_rsum=1.3100734148943491,x_shift=0.7586799647899636,x_delta=-0.5540766590236605,x_counter=3,y_rsum=1.5872724965935805,y_shift=0.5221511083334797,y_delta=-0.1838325828168319,y_counter=3
a=eks,bbb=wye,i=4,x=0.38139939387114097,y=0.13418874328430463,x_rsum=1.6914728087654902,x_shift=0.20460330576630303,x_delta=0.17679608810483793,x_counter=4,y_rsum=1.7214612398778852,y_shift=0.33831852551664776,y_delta=-0.20412978223234313,y_counter=4
a=wye,b=pan,i=5,xxx=0.5732889198020006,y=0.8636244699032729,y_rsum=2.585085709781158,y_shift=0.13418874328430463,y_delta=0.7294357266189683,y_counter=5
a=zee,b=pan,i=6,x=0.5271261600918548,y=0.49322128674835697,x_rsum=2.218598968857345,x_shift=0.38139939387114097,x_delta=0.1457267662207138,x_counter=5,y_rsum=3.0783069965295153,y_shift=0.8636244699032729,y_delta=-0.37040318315491594,y_counter=6
a=eks,b=zee,iii=7,x=0.6117840605678454,y=0.1878849191181694,x_rsum=2.8303830294251906,x_shift=0.5271261600918548,x_delta=0.08465790047599064,x_counter=6,y_rsum=3.266191915647685,y_shift=0.49322128674835697,y_delta=-0.30533636763018757,y_counter=7
a=zee,b=wye,i=8,x=0.5985540091064224,yyy=0.976181385699006,x_rsum=3.428937038531613,x_shift=0.6117840605678454,x_delta=-0.013230051461422976,x_counter=7
aaa=hat,bbb=wye,i=9,x=0.03144187646093577,y=0.7495507603507059,x_rsum=3.460378914992549,x_shift=0.5985540091064224,x_delta=-0.5671121326454867,x_counter=8,y_rsum=4.015742675998391,y_shift=0.1878849191181694,y_delta=0.5616658412325365,y_counter=8
a=pan,b=wye,i=10,x=0.5026260055412137,y=0.9526183602969864,x_rsum=3.9630049205337627,x_shift=0.03144187646093577,x_delta=0.47118412908027796,x_counter=9,y_rsum=4.968361036295377,y_shift=0.7495507603507059,y_delta=0.20306759994628054,y_counter=9

mlr --odkvp step -a rsum,shift,delta,counter -f x,y -g a ./reg-test/input/abixy-het
a=pan,b=pan,i=1,x=0.3467901443380824,y=0.7268028627434533,x_rsum=0.3467901443380824,x_shift=,x_delta=0,x_counter=1,y_rsum=0.7268028627434533,y_shift=,y_delta=0,y_counter=1
a=eks,b=pan,i=2,x=0.7586799647899636,y=0.5221511083334797,x_rsum=0.7586799647899636,x_shift=,x_delta=0,x_counter=1,y_rsum=0.5221511083334797,y_shift=,y_delta=0,y_counter=1
aaa=wye,b=wye,i=3,x=0.20460330576630303,y=0.33831852551664776
a=eks,bbb=wye,i=4,x=0.38139939387114097,y=0.13418874328430463,x_rsum=1.1400793586611044,x_shift=0.7586799647899636,x_delta=-0.3772805709188226,x_counter=2,y_rsum=0.6563398516177843,y_shift=0.5221511083334797,y_delta=-0.38796236504917503,y_counter=2
a=wye,b=pan,i=5,xxx=0.5732889198020006,y=0.8636244699032729,y_rsum=0.8636244699032729,y_shift=,y_delta=0,y_counter=1
a=zee,b=pan,i=6,x=0.5271261600918548,y=0.49322128674835697,x_rsum=0.5271261600918548,x_shift=,x_delta=0,x_counter=1,y_rsum=0.49322128674835697,y_shift=,y_delta=0,y_counter=1
a=eks,b=zee,iii=7,x=0.6117840605678454,y=0.1878849191181694,x_rsum=1.75186341922895,x_shift=0.38139939387114097,x_delta=0.23038466669670443,x_counter=3,y_rsum=0.8442247707359537,y_shift=0.13418874328430463,y_delta=0.05369617583386477,y_counter=3
a=zee,b=wye,i=8,x=0.5985540091064224,yyy=0.976181385699006,x_rsum=1.1256801691982772,x_shift=0.5271261600918548,x_delta=0.07142784901456767,x_counter=2
aaa=hat,bbb=wye,i=9,x=0.03144187646093577,y=0.7495507603507059
a=pan,b=wye,i=10,x=0.5026260055412137,y=0.9526183602969864,x_rsum=0.8494161498792961,x_shift=0.3467901443380824,x_delta=0.1558358612031313,x_counter=2,y_rsum=1.6794212230404397,y_shift=0.7268028627434533,y_delta=0.22581549755353314,y_counter=2

mlr --opprint step -a ewma -d 0.1,0.9 -f x,y -g a ./reg-test/input/abixy-het
a   b   i x                  y                  x_ewma_0.1         x_ewma_0.9         y_ewma_0.1         y_ewma_0.9
pan pan 1 0.3467901443380824 0.7268028627434533 0.3467901443380824 0.3467901443380824 0.7268028627434533 0.7268028627434533
eks pan 2 0.7586799647899636 0.5221511083334797 0.7586799647899636 0.7586799647899636 0.5221511083334797 0.5221511083334797

aaa b   i x                   y
wye wye 3 0.20460330576630303 0.33831852551664776

a   bbb i x                   y                   x_ewma_0.1         x_ewma_0.9          y_ewma_0.1         y_ewma_0.9
eks wye 4 0.38139939387114097 0.13418874328430463 0.7209519076980814 0.41912745096302323 0.4833548718285622 0.17298497978922212

a   b   i xxx                y                  y_ewma_0.1         y_ewma_0.9
wye pan 5 0.5732889198020006 0.8636244699032729 0.8636244699032729 0.8636244699032729

a   b   i x                  y                   x_ewma_0.1         x_ewma_0.9         y_ewma_0.1          y_ewma_0.9
zee pan 6 0.5271261600918548 0.49322128674835697 0.5271261600918548 0.5271261600918548 0.49322128674835697 0.49322128674835697

a   b   iii x                  y                  x_ewma_0.1         x_ewma_0.9         y_ewma_0.1         y_ewma_0.9
eks zee 7   0.6117840605678454 0.1878849191181694 0.7100351229850579 0.5925183996073632 0.4538078765575229 0.18639492518527467

a   b   i x                  yyy               x_ewma_0.1         x_ewma_0.9
zee wye 8 0.5985540091064224 0.976181385699006 0.5342689449933116 0.5914112242049656

aaa bbb i x                   y
hat wye 9 0.03144187646093577 0.7495507603507059

a   b   i  x                  y                  x_ewma_0.1         x_ewma_0.9         y_ewma_0.1         y_ewma_0.9
pan wye 10 0.5026260055412137 0.9526183602969864 0.3623737304583956 0.4870424194209006 0.7493844124988066 0.9300368105416331

mlr --opprint step -a ewma -d 0.1,0.9 -o smooth,rough -f x,y -g a ./reg-test/input/abixy-het
a   b   i x                  y                  x_ewma_smooth      x_ewma_rough       y_ewma_smooth      y_ewma_rough
pan pan 1 0.3467901443380824 0.7268028627434533 0.3467901443380824 0.3467901443380824 0.7268028627434533 0.7268028627434533
eks pan 2 0.7586799647899636 0.5221511083334797 0.7586799647899636 0.7586799647899636 0.5221511083334797 0.5221511083334797

aaa b   i x                   y
wye wye 3 0.20460330576630303 0.33831852551664776

a   bbb i x                   y                   x_ewma_smooth      x_ewma_rough        y_ewma_smooth      y_ewma_rough
eks wye 4 0.38139939387114097 0.13418874328430463 0.7209519076980814 0.41912745096302323 0.4833548718285622 0.17298497978922212

a   b   i xxx                y                  y_ewma_smooth      y_ewma_rough
wye pan 5 0.5732889198020006 0.8636244699032729 0.8636244699032729 0.8636244699032729

a   b   i x                  y                   x_ewma_smooth      x_ewma_rough       y_ewma_smooth       y_ewma_rough
zee pan 6 0.5271261600918548 0.49322128674835697 0.5271261600918548 0.5271261600918548 0.49322128674835697 0.49322128674835697

a   b   iii x                  y                  x_ewma_smooth      x_ewma_rough       y_ewma_smooth      y_ewma_rough
eks zee 7   0.6117840605678454 0.1878849191181694 0.7100351229850579 0.5925183996073632 0.4538078765575229 0.18639492518527467

a   b   i x                  yyy               x_ewma_smooth      x_ewma_rough
zee wye 8 0.5985540091064224 0.976181385699006 0.5342689449933116 0.5914112242049656

aaa bbb i x                   y
hat wye 9 0.03144187646093577 0.7495507603507059

a   b   i  x                  y                  x_ewma_smooth      x_ewma_rough       y_ewma_smooth      y_ewma_rough
pan wye 10 0.5026260055412137 0.9526183602969864 0.3623737304583956 0.4870424194209006 0.7493844124988066 0.9300368105416331

mlr --icsvlite --opprint step -a from-first -f x ./reg-test/input/from-first.csv
x   g     x_from_first
100 red   0
203 red   103
101 green 1
307 red   207
209 green 109
314 green 214

mlr --icsvlite --opprint step -a from-first -f x -g g ./reg-test/input/from-first.csv
x   g     x_from_first
100 red   0
203 red   103
101 green 0
307 red   207
209 green 108
314 green 213

